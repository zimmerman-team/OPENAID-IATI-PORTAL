<div id="main-content" class="container activity">
    <detail-filter-bar 
        activity-id="vm.activityId" 
        current-page="activity"></detail-filter-bar>
    
    <div class="row">
        <div class="col-md-12">
            <h1 class="title no-margin-bottom">{{vm.activity.titles[0].title}}</h1>
            <p>{{vm.activity.descriptions[0].description}}</p>
        </div>
    </div>

    <sub-navbar 
        tabs='vm.tabs' 
        selected-tab='vm.selectedTab'>
    </sub-navbar>

    
    <div ng-show="vm.selectedTab == 'summary'">

        <activity-geomap map-height="350px" activity="vm.activity"></activity-geomap>

        <div class="row" style="margin-top:15px;">

            <!-- start linker kolom -->
            <div class="col-md-4">

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>IATI identifier</b><br>{{vm.activity.iati_identifier}}</p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Reporting organisations</b><br>{{vm.activity.reporting_organisation.name}}</p>
                            <p><b>Participating organisations</b><br><span ng-repeat='org in vm.activity.participating_organisations'>{{org.name}}, </span></p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Last update</b><br>{{vm.activity.last_updated_datetime | date : 'dd MMM yyyy'}}</p>
                            <p><b>Start date planned</b><br>{{vm.activity.start_planned.length ? vm.activity.start_planned : 'No data available' | date : 'dd MMM yyyy'}}</p>

                            <p><b>Start date actual</b><br>{{vm.activity.start_actual.length ? vm.activity.start_actual : 'No data available' | date : 'dd MMM yyyy'}}</p>

                            <p><b>End date planned</b><br>{{vm.activity.end_planned.length ? vm.activity.end_planned : 'No data available' | date : 'dd MMM yyyy'}}</p>

                            <p><b>End date actual</b><br>{{vm.activity.end_actual.length ? vm.activity.end_actual : 'No data available' | date : 'dd MMM yyyy'}}</p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Activity scope</b><br>
                                <span ng-if='vm.activity.activity_scope.name.length'>{{vm.activity.activity_scope.name}}</span>
                                <span ng-if='!vm.activity.activity_scope.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->

                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">

                            <p>
                                <b>Other identifiers</b><br>
                                <a ng-repeat="other_identifier in vm.activity.other_identifier">
                                    {{other_identifier.name}}
                                </a>
                                <span ng-if='vm.activity.related_activities.length == 0'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p>
                                <b>Related activities</b><br>
                                <a ng-repeat="act in vm.activity.related_activities">
                                    {{act.id}}
                                </a>
                                <span ng-if='vm.activity.related_activities.length == 0'>No data available</span>
                            </p>

                        </div>
                    </div>
                </div>

                


            </div>
            <!-- eind linker kolom -->

            <!-- start midden kolom -->
            <div class="col-md-4">

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Status</b><br>{{vm.activity.activity_status.name}}</p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Estimated budget</b><br>
                                <span ng-if='vm.activity.total_budget.length'>{{vm.activity.total_budget | shortcurrency :'€'}}</span>
                                <span ng-if='!vm.activity.total_budget.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Capital spend</b><br>
                                <span ng-if='vm.activity.activity_scope.name.length'>{{vm.activity.capital_spend.percentage}}</span>
                                <span ng-if='!vm.activity.activity_scope.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Finance type</b><br>
                                <span ng-if='vm.activity.default_finance_type.name.length'>{{vm.activity.default_finance_type.name}}</span>
                                <span ng-if='!vm.activity.default_finance_type.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Flow type</b><br>
                                <span ng-if='vm.activity.default_flow_type.name.length'>{{vm.activity.default_flow_type.name}}</span>
                                <span ng-if='!vm.activity.default_flow_type.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Tied status</b><br>
                                <span ng-if='vm.activity.default_tied_status.name.length'>{{vm.activity.default_tied_status.name}}</span>
                                <span ng-if='!vm.activity.default_tied_status.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Collaboration type</b><br>
                                <span ng-if='vm.activity.collaboration_type.name.length'>{{vm.activity.collaboration_type.name}}</span>
                                <span ng-if='!vm.activity.collaboration_type.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Aid type</b><br>
                                <span ng-if='vm.activity.default_aid_type.name.length'>{{vm.activity.default_aid_type.name}}</span>
                                <span ng-if='!vm.activity.default_aid_type.name.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->


                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">

                            <p>
                                <b>Websites</b><br>
                                <a ng-repeat="website in vm.activity.websites">
                                    {{website.name}}
                                </a>
                                <span ng-if='vm.activity.websites.length == 0'>No data available</span>
                            </p>

                        </div>
                    </div>
                </div>

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Linked data URI</b><br>
                                <span ng-if='vm.activity.linked_data_uri.length'>{{vm.activity.linked_data_uri}}</span>
                                <span ng-if='!vm.activity.linked_data_uri.length'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p><b>Hierarchy</b><br>
                                <span ng-if='vm.activity.hierarchy'>{{vm.activity.hierarchy}}</span>
                                <span ng-if='!vm.activity.hierarchy'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->

            </div>
            <!-- eind midden kolom -->

            <!-- start rechter kolom -->
            <div class="col-md-4">

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">
                            <p>
                                <b>Country</b><br>
                                <a ng-repeat="country in vm.activity.countries" ui-sref="country({ country_id: country.code })">
                                    {{country.name}}
                                </a>
                                <span ng-if='vm.activity.countries.length == 0'>No data available</span>
                            </p>

                            <p>
                                <b>Region</b><br>
                                <a ng-repeat="region in vm.activity.regions" ui-sref="region({ region_id: region.code })">
                                    {{region.name}}
                                </a>
                                <span ng-if='vm.activity.regions.length == 0'>No data available</span>
                            </p>

                            <p>
                                <b>Locations</b><br>
                                <span ng-repeat="location in vm.activity.locations" >
                                    {{location.name}},
                                </span>
                                <span ng-if='vm.activity.locations.length == 0'>No data available</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->

                <!--start van een wit blokje -->
                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit" ng-click="vm.dashboard = 'list'">
                            <p><b>Sector</b><br><a ui-sref="sector({ sector_id: vm.activity.sectors[0].code })">{{vm.activity.sectors[0].name}}</a></p>
                            <p><b>Sector code</b><br><a ui-sref="sector({ sector_id: vm.activity.sectors[0].code })">{{vm.activity.sectors[0].code}}</a></p>
                        </div>
                    </div>
                </div>
                <!-- eind van een wit blokje -->
                <!--start van een wit blokje -->

                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit" ng-click="vm.dashboard = 'list'">
                            <b>Policy Markers</b>&nbsp;<br>&nbsp;<br>

                            <p>
                                <b>Principal objectives</b>
                                <ul ng-if='vm.activity.policy_markers.length != 0'>
                                    <li ng-if="marker.significance.code == 2" ng-repeat="marker in vm.activity.policy_markers">
                                    {{marker.policy_marker.name}}
                                    </li>
                                </ul>
                            </p>
                            <p>
                                <b>Significant objectives</b>
                                <ul ng-if='vm.activity.policy_markers.length != 0'>
                                    <li ng-if="marker.significance.code == 1" ng-repeat="marker in vm.activity.policy_markers">
                                    {{marker.policy_marker.name}}
                                    </li>
                                </ul>
                            </p>
                            <p>
                                <b>Not targeted</b>
                                <ul ng-if='vm.activity.policy_markers.length != 0'>
                                    <li ng-if="marker.significance.code == 0" ng-repeat="marker in vm.activity.policy_markers">
                                    {{marker.policy_marker.name}}
                                    </li>
                                </ul>
                                <span ng-if='vm.activity.policy_markers.length == 0'>No data available</span>
                            </p> 
                        </div>
                    </div>
                </div>

                <!-- eind van een wit blokje -->

                <div class="row">
                    <div class="col-sm-12 activity-list-item">
                        <div class="hp-block wit">

                            <p>
                                <b>Results</b><br>
                                <a ng-repeat="result in vm.activity.results">
                                    {{result.name}}
                                </a>
                                <span ng-if='vm.activity.results.length == 0'>No data available</span>
                            </p>

                        </div>
                    </div>
                </div>

            </div>
            <!-- eind rechter kolom -->
        </div>
    </div>


    <!-- voor op transacties page -->
    <div class="row" ng-if="vm.selectedTab == 'transactions'">
        <div class="col-sm-12">
            <div class="hp-block wit">
                <h3>Transactions</h3>
                <nvd3 options="vm.transactionChartOptions" data="vm.transactionData" class="with-3d-shadow with-transitions"></nvd3>
            </div>
        </div>

        <div class="col-md-6 activity-list-item">
            <div class="hp-block wit financial extra">
                <p><b>Expenditure</b></p>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Receiving organisation</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="transaction in vm.activity.transactions | orderBy:'transaction_date'" ng-if="transaction.transaction_type == 'D'">
                            <td>{{transaction.transaction_date | date : 'dd MMM yyyy'}}</td>
                            <td>{{transaction.receiver_organisation_name}}</td>
                            <td>{{transaction.value | shortcurrency :'€'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-6 activity-list-item">
            <div class="hp-block wit financial extra">
                <p><b>Commitments</b></p>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Receiving organisation</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="transaction in vm.activity.transactions | orderBy:'transaction_date'" ng-if="transaction.transaction_type == 'C'">
                            <td>{{transaction.transaction_date | date : 'dd MMM yyyy'}}</td>
                            <td>{{transaction.receiver_organisation_name}}</td>
                            <td>{{transaction.value | shortcurrency :'€'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    
    </div>


    <!-- voor op documenten page -->
    <div class="row" ng-show="vm.selectedTab == 'documents'">
        <div class="col-md-12">
            <div class="hp-block wit">
                <h3>Documents</h3>

                <div ng-show="vm.activity.documents.length == 0">
                    No documents available.
                </div>
                <table class="table documents" ng-if="vm.activity.documents.length != 0">
                    <tbody>
                        <tr ng-repeat="document in vm.activity.documents">
                            
                            <td>
                                <a target="_blank" href="{{document.url}}">
                                    <i class="glyphicon glyphicon-download-alt"></i>{{document.title}}
                                </a>
                            </td>
                            
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row" ng-show="vm.selectedTab == 'thirdparty'">
        <div class="col-md-12">
            <div class="hp-block wit">
                <h3>Funded projects in IATI</h3>
                <div ng-show="!vm.providedActivities.length">
                    No IATI references found.
                </div>
                <table class="table table-striped provided-activities-table" ng-show="vm.providedActivities.length">
                    <thead>
                        <th class="col-sm-6">
                            Title
                        </th>
                        <th class="col-sm-3">
                            Reporting organisation
                        </th>
                        <th class="col-sm-3">
                            IATI identifier
                        </th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="providerActivity in vm.providedActivities">
                            <td class="col-sm-6">
                                {{providerActivity.title.narratives[0].text}}
                            </td>
                            <td class="col-sm-3">
                                {{providerActivity.reporting_organisations[0].narratives[0].text}}
                            </td>
                            <td class="col-sm-3">
                                {{providerActivity.iati_identifier}}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="hp-block wit rsr">
                <h3>Akvo Really Simple Reporting (RSR)</h3>
                <p ng-if="vm.rsrProjects.length">
                    The following RSR projects are funded by this OpenaidNL activity.
                </p>
                <p ng-if="!vm.rsrProjects.length && !vm.rsrLoading">
                    No related RSR projects found.
                </p>
                <div class="row" ng-show="vm.rsrLoading">
                    <div class="svg-loader">
                        <img ng-src="{{vm.templateBaseUrl}}/images/spinning-circles.svg" width="50" alt="">
                    </div>
                </div>
            </div>



        </div>

        <div 
            class="activity-list-item col-sm-12" 
            ng-show="vm.rsrProjects.length != 0"
            ng-repeat="item in vm.rsrProjects">

            <div class="row">
                <div class="col-sm-12">
                    <div class="hp-block wit header">
                        <div class="row">
                            <div class="col-sm-2">

                                <img ng-src="http://rsr.akvo.org{{item.current_image.thumbnails.map_thumb}}">
                            </div>
                            <div class="col-sm-10">
                                <h2>
                                    <a target="_blank" ng-href="http://rsr.akvo.org/en/project/{{item.id}}/">
                                        {{ item.title }}
                                    </a>
                                </h2>
                                <p>{{item.project_plan_summary}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


